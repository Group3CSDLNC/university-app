<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Quản lý Nhân viên</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
<div class="container mt-4">
    <h2 class="mb-4">Quản lý Nhân viên</h2>

    <!-- Form thêm/sửa nhân viên -->
    <form id="nvForm" class="mb-4">
        <input type="hidden" id="maNV">
        <div class="form-row">
            <div class="col">
                <input type="text" id="hoTen" class="form-control" placeholder="Họ tên" required>
            </div>
            <div class="col">
                <input type="text" id="hocVi" class="form-control" placeholder="Học vị">
            </div>
            <div class="col">
                <input type="text" id="vaiTro" class="form-control" placeholder="Vai trò" required>
            </div>
            <div class="col">
                <input type="email" id="email" class="form-control" placeholder="Email" required>
            </div>
            <div class="col-auto">
                <button type="submit" class="btn btn-primary">Lưu</button>
            </div>
        </div>
    </form>

    <!-- Bảng danh sách nhân viên -->
    <table class="table table-bordered table-striped">
        <thead>
        <tr>
            <th>Mã NV</th>
            <th>Họ tên</th>
            <th>Học vị</th>
            <th>Vai trò</th>
            <th>Email</th>
            <th>Hành động</th>
        </tr>
        </thead>
        <tbody id="nvTableBody">
        <!-- Data sẽ được load từ API -->
        </tbody>
    </table>
</div>

<script>
    const apiUrl = "/api/nhanVien";

    // Load danh sách nhân viên
    async function loadNhanVien() {
        const res = await fetch(apiUrl);
        const data = await res.json();
        const tbody = document.getElementById("nvTableBody");
        tbody.innerHTML = "";
        data.forEach(nv => {
            tbody.innerHTML += `
                <tr>
                    <td>${nv.maNV}</td>
                    <td>${nv.hoTen}</td>
                    <td>${nv.hocVi || ''}</td>
                    <td>${nv.vaiTro}</td>
                    <td>${nv.email}</td>
                    <td>
                        <button class="btn btn-sm btn-warning" onclick="editNV(${nv.maNV})">Sửa</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteNV(${nv.maNV})">Xóa</button>
                    </td>
                </tr>
            `;
        });
    }

    // Thêm hoặc cập nhật nhân viên
    document.getElementById("nvForm").addEventListener("submit", async function (e) {
        e.preventDefault();
        const maNV = document.getElementById("maNV").value;
        const nv = {
            hoTen: document.getElementById("hoTen").value,
            hocVi: document.getElementById("hocVi").value,
            vaiTro: document.getElementById("vaiTro").value,
            email: document.getElementById("email").value
        };
        let res;
        if (maNV) {
            res = await fetch(`${apiUrl}/${maNV}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(nv)
            });
        } else {
            res = await fetch(apiUrl, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(nv)
            });
        }
        if (res.ok) {
            loadNhanVien();
            this.reset();
            document.getElementById("maNV").value = "";
        } else {
            alert("Lỗi khi lưu nhân viên");
        }
    });

    // Sửa nhân viên
    async function editNV(id) {
        const res = await fetch(`${apiUrl}/${id}`);
        const nv = await res.json();
        document.getElementById("maNV").value = nv.maNV;
        document.getElementById("hoTen").value = nv.hoTen;
        document.getElementById("hocVi").value = nv.hocVi;
        document.getElementById("vaiTro").value = nv.vaiTro;
        document.getElementById("email").value = nv.email;
    }

    // Xóa nhân viên
    async function deleteNV(id) {
        if (confirm("Bạn có chắc muốn xóa nhân viên này?")) {
            const res = await fetch(`${apiUrl}/${id}`, { method: "DELETE" });
            if (res.ok) {
                loadNhanVien();
            } else {
                alert("Không thể xóa nhân viên!");
            }
        }
    }

    // Load danh sách khi mở trang
    loadNhanVien();
</script>
</body>
</html>
