<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√°o c√°o ƒë√†o t·∫°o</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <style>
        body { overflow-x: hidden; }
        .sidebar {
            min-height: 100vh;
            background: #f8f9fa;
            border-right: 1px solid #ddd;
            padding-top: 20px;
        }
        .sidebar .nav-link {
            color: #333;
            margin-bottom: 5px;
        }
        .sidebar .nav-link.active {
            background: #007bff;
            color: white !important;
            border-radius: 5px;
        }
        .content {
            padding: 20px;
        }
        .loading { display: none; text-align: center; color: #6c757d; margin: 10px 0; }
    </style>
</head>
<body>

<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <nav class="col-md-2 d-none d-md-block sidebar">
            <h5 class="px-3">B√°o c√°o</h5>
            <ul class="nav flex-column" id="reportMenu">
                <li class="nav-item">
                    <a class="nav-link active" href="#" onclick="showTab('siso')">üìä Sƒ© s·ªë & ph√≤ng h·ªçc</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" onclick="showTab('lichtrung')">üìÖ L·ªãch tr√πng ph√≤ng</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" onclick="showTab('sv')">üéì SV ch∆∞a ho√†n th√†nh</a>
                </li>
            </ul>
        </nav>

        <!-- Content -->
        <main class="col-md-10 ml-sm-auto content">
            <h2 id="tabTitle">üìä Sƒ© s·ªë & ph√≤ng h·ªçc</h2>

            <!-- Tab: Sƒ© s·ªë -->
            <div id="tab-siso" class="tab-content">
                <div id="loading-siso" class="loading">ƒêang t·∫£i...</div>
                <table class="table table-bordered">
                    <thead class="thead-light">
                    <tr>
                        <th>M√£ LHP</th>
                        <th>T√™n HP</th>
                        <th>Sƒ© s·ªë th·ª±c t·∫ø</th>
                        <th>Sƒ© s·ªë t·ªëi ƒëa</th>
                        <th>Ph√≤ng</th>
                        <th>S·ª©c ch·ª©a</th>
                        <th>Tr·∫°ng th√°i</th>
                    </tr>
                    </thead>
                    <tbody id="sisoTableBody"></tbody>
                </table>
            </div>

            <!-- Tab: L·ªãch tr√πng -->
            <div id="tab-lichtrung" class="tab-content d-none">
                <div id="loading-lichtrung" class="loading">ƒêang t·∫£i...</div>
                <table class="table table-bordered">
                    <thead class="thead-light">
                    <tr>
                        <th>M√£ LHP</th>
                        <th>Ph√≤ng</th>
                        <th>Th·ª©</th>
                        <th>Ti·∫øt b·∫Øt ƒë·∫ßu</th>
                        <th>S·ªë ti·∫øt</th>
                        <th>LHP tr√πng</th>
                        <th>Ti·∫øt b·∫Øt ƒë·∫ßu (tr√πng)</th>
                        <th>S·ªë ti·∫øt (tr√πng)</th>
                    </tr>
                    </thead>
                    <tbody id="lichtrungTableBody"></tbody>
                </table>
            </div>

            <!-- Tab: SV ch∆∞a ho√†n th√†nh -->
            <div id="tab-sv" class="tab-content d-none">
                <div class="form-inline mb-3">
                    <label class="mr-2">Ch·ªçn CTDT:</label>
                    <select id="selectCTDT" class="form-control mr-2"></select>
                    <button class="btn btn-primary" onclick="loadSV()">Xem b√°o c√°o</button>
                </div>
                <div id="loading-sv" class="loading">ƒêang t·∫£i...</div>
                <table class="table table-bordered">
                    <thead class="thead-light">
                    <tr>
                        <th>M√£ SV</th>
                        <th>H·ªç t√™n</th>
                        <th>M√£ HP</th>
                        <th>T√™n HP</th>
                        <th>L·∫ßn thi</th>
                        <th>ƒêi·ªÉm CC</th>
                        <th>ƒêi·ªÉm GK</th>
                        <th>ƒêi·ªÉm CK</th>
                        <th>T·ªïng k·∫øt</th>
                        <th>Tr·∫°ng th√°i</th>
                    </tr>
                    </thead>
                    <tbody id="svTableBody"></tbody>
                </table>
            </div>
        </main>
    </div>
</div>

<script>
    // Qu·∫£n l√Ω tab
    function showTab(tab) {
        document.querySelectorAll('.tab-content').forEach(div => div.classList.add('d-none'));
        document.getElementById(`tab-${tab}`).classList.remove('d-none');
        document.querySelectorAll('.sidebar .nav-link').forEach(a => a.classList.remove('active'));
        event.target.classList.add('active');

        if (tab === 'siso') { loadSiSo(); document.getElementById("tabTitle").innerText = "üìä Sƒ© s·ªë & ph√≤ng h·ªçc"; }
        if (tab === 'lichtrung') { loadLichTrung(); document.getElementById("tabTitle").innerText = "üìÖ L·ªãch tr√πng ph√≤ng"; }
        if (tab === 'sv') { loadCTDTList(); document.getElementById("tabTitle").innerText = "üéì SV ch∆∞a ho√†n th√†nh"; }
    }

    // Load b√°o c√°o sƒ© s·ªë
    async function loadSiSo() {
        document.getElementById("loading-siso").style.display = "block";
        const data = await fetch("/api/baocao/siso").then(r => r.json());
        const tbody = document.getElementById("sisoTableBody");
        tbody.innerHTML = "";
        data.forEach(r => {
            tbody.innerHTML += `<tr>
        <td>${r.MaLHP}</td><td>${r.TenHP}</td><td>${r.SiSoThucTe}</td>
        <td>${r.SiSoToiDa}</td><td>${r.SoPhong||""}</td>
        <td>${r.SucChua||""}</td><td>${r.TrangThaiPhong}</td>
      </tr>`;
        });
        document.getElementById("loading-siso").style.display = "none";
    }

    // Load l·ªãch tr√πng
    async function loadLichTrung() {
        document.getElementById("loading-lichtrung").style.display = "block";
        const data = await fetch("/api/baocao/lichtrung").then(r => r.json());
        const tbody = document.getElementById("lichtrungTableBody");
        tbody.innerHTML = "";
        data.forEach(r => {
            tbody.innerHTML += `<tr>
        <td>${r.MaLHP}</td><td>${r.MaPH}</td><td>${r.ThuTrongTuan}</td>
        <td>${r.TietBatDau}</td><td>${r.SoTiet}</td>
        <td>${r.MaLHP_Trung}</td><td>${r.TietBatDau_Trung}</td><td>${r.SoTiet_Trung}</td>
      </tr>`;
        });
        document.getElementById("loading-lichtrung").style.display = "none";
    }

    // Load danh s√°ch CTDT
    async function loadCTDTList() {
        const data = await fetch("/api/baocao/ctdt-list").then(r => r.json());
        const select = document.getElementById("selectCTDT");
        select.innerHTML = '<option value="">-- Ch·ªçn CTDT --</option>';
        data.forEach(ct => {
            select.innerHTML += `<option value="${ct.maCTDT}">${ct.tenCTDT}</option>`;
        });
    }

    // Load SV ch∆∞a ho√†n th√†nh
    async function loadSV() {
        const maCTDT = document.getElementById("selectCTDT").value;
        if (!maCTDT) { alert("Ch·ªçn CTDT tr∆∞·ªõc!"); return; }
        document.getElementById("loading-sv").style.display = "block";
        const data = await fetch(`/api/baocao/chua-hoanthanh/${maCTDT}`).then(r => r.json());
        const tbody = document.getElementById("svTableBody");
        tbody.innerHTML = "";
        data.forEach(r => {
            tbody.innerHTML += `<tr>
        <td>${r.MaSV}</td><td>${r.HoTen}</td><td>${r.MaHP}</td><td>${r.TenHP}</td>
        <td>${r.LanThi||""}</td><td>${r.DiemCC||""}</td><td>${r.DiemGK||""}</td>
        <td>${r.DiemCK||""}</td><td>${r.TongKet||""}</td><td>${r.TrangThai}</td>
      </tr>`;
        });
        document.getElementById("loading-sv").style.display = "none";
    }

    // Load m·∫∑c ƒë·ªãnh tab ƒë·∫ßu ti√™n
    window.onload = loadSiSo;
</script>

<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
</body>
</html>
